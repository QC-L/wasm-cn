<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="keywords" content="WebAssembly,wasm,中文,文档,中文文档"/>
  <meta name="description" content="WebAssembly 中文文档"/>
  <title>开发者指南 - WebAssembly</title>
  <link rel="stylesheet" type="text/css" href="/css/custom.css">
</head>


<body>
  <header class="page-section-spacious">
    <div class="container">
    <div class="site-logo">
      <h1 class="title">
        <a href="/">WebAssembly 中文文档</a>
      </h1>
    </div>
    <nav class="site-nav">
      <a class="site-nav-item btn" href="/">总览</a>
      <a class="site-nav-item btn" href="/demo/">实例</a>
      <a class="site-nav-item btn" href="/getting-started/developers-guide/">快速开始</a>
      
      
      <a class="site-nav-item btn" href="/docs/js/">文档</a>
      <a class="site-nav-item btn" href="/community/feedback/">社区</a>
      <a class="site-nav-item btn" href="/roadmap/">规划</a>
      <a class="site-nav-item btn" href="/docs/faq/">问答</a>
      <a class="site-nav-item btn" style="color:#adadad" href="https://github.com/int64ago/wasm-cn" target="_blank">&#60;参与翻译/&#62;</a>
    </nav>
    </div>
  </header>
  <section class="banner-update">
    <div class="container">
      <div class="banner-update-icon"></div>
      <span class="banner-update-date"></span>
      <span>WebAssembly 初版规范已由各个浏览器厂商达成共识，<a href="/roadmap/">了解更多</a></span>
    </div>
  </section>
  

<section>
  <div class="container">
    <div class="row">
      <div class="col-xs-12 col-lg-9 col-pop">
        <h1 id="开发者指南">开发者指南</h1>

<p>在这里，手把手教你编译一个 WebAssembly 程序</p>

<h3 id="依赖">依赖</h3>
<p>编译 WebAssembly 之前，需要先从源码编译 LLVM ，以下是一些依赖：</p>

<ul>
  <li>Git，Linux 和 OSX 这个应该是内置的，Windows 的话可以直接下载 <a href="https://git-scm.com/">Git for Windows</a> 安装</li>
  <li>CMake，如果是 Linux 或 OSX，可以通过包管理器如 <code class="highlighter-rouge">apt-get</code> 或 <code class="highlighter-rouge">brew</code> 等安装，Windows 需要下载 <a href="https://cmake.org/download/">CMake installer</a> 并安装</li>
  <li>编译器，Linux 安装 <a href="http://askubuntu.com/questions/154402/install-gcc-on-ubuntu-12-04-lts">GCC</a>，OSX 安装 <a href="https://itunes.apple.com/us/app/xcode/id497799835">Xcode</a> ，Windows 安装 <a href="https://www.visualstudio.com/downloads/">VS2015+</a></li>
  <li>Python 2.7.x，Linux 和 OSX 这个应该是内置的，其它具体见 <a href="https://wiki.python.org/moin/BeginnersGuide/Download">这里</a></li>
</ul>

<p>安装完后，请确保 <code class="highlighter-rouge">git</code> 、 <code class="highlighter-rouge">cmake</code> 和 <code class="highlighter-rouge">python</code> 环境变量配置正确</p>

<h3 id="从源码构建-emscripten">从源码构建 Emscripten</h3>
<p>从源码构建 Emscripten 是通过 Emscripten SDK 自动进行的，步骤如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ git clone https://github.com/juj/emsdk.git
$ cd emsdk
$ ./emsdk install sdk-incoming-64bit binaryen-master-64bit
$ ./emsdk activate sdk-incoming-64bit binaryen-master-64bit
</code></pre>
</div>

<p>以上步骤结束后，设置下 Emscripten 编译器环境变量</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ source ./emsdk_env.sh
</code></pre>
</div>

<p>这个命令把相关的环境变量加入到 PATH 下，不过只限当前终端有效</p>

<p>如果是 Windows，仅仅把上述的 <code class="highlighter-rouge">./emsdk</code> 替换为 <code class="highlighter-rouge">emsdk</code> ，把 <code class="highlighter-rouge">source ./emsdk_env.sh</code> 替换为 <code class="highlighter-rouge">emsdk_env</code> 即可</p>

<h3 id="编译并运行一个简单程序">编译并运行一个简单程序</h3>
<p>现在我们构建 WebAssembly 可谓万事俱备只欠东风了，但还有些注意事项：</p>

<ul>
  <li><code class="highlighter-rouge">emcc</code> 需要传参数 <code class="highlighter-rouge">-s WASM=1</code> （默认编译出 asm.js）</li>
  <li>如果想让 Emscripten 直接编译出可直接使用的 HTML 而不是 wasm 二进制，你需要指定输出后缀为 <code class="highlighter-rouge">.html</code></li>
  <li>最后，不可以直接打开 HTML 去看运行的结果，因为有跨域限制，我们需要去启动一个简单的 HTTP 服务器</li>
</ul>

<p>以下命令会创建一个简单的 “hello world” 程序，编译部分已经加粗</p>

<pre>
$ mkdir hello
$ cd hello
$ echo '#include &lt;stdio.h&gt;' &gt; hello.c
$ echo 'int main(int argc, char ** argv) {' &gt;&gt; hello.c
$ echo 'printf("Hello, world!\n");' &gt;&gt; hello.c
$ echo '}' &gt;&gt; hello.c
$ <b>emcc hello.c -s WASM=1 -o hello.html</b>
</pre>

<p>我们可以直接使用 Emscripten SDK 提供的 <code class="highlighter-rouge">emrun</code> 来启一个 Web 服务器</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ emrun --no_browser --port 8080 .
</code></pre>
</div>

<p>服务启动后可以<a href="http://localhost:8080/hello.html" target="_blank">浏览器访问这个</a>看效果，如果你看到控制台输出了 “Hello, world!”， 恭喜你，成功完成了第一个 WebAssembly 程序！</p>

      </div>
      <div class="col-xs-12 col-lg-3">
        <h6 class="side-title">快速开始</h6>
        <nav class="side-nav">
          <a class="side-nav-item" href="/getting-started/developers-guide/">开发者指南</a>
          <a class="side-nav-item" href="/getting-started/js-api/">JS API</a>
          <a class="side-nav-item" href="/getting-started/advanced-tools/">高级工具</a>
          <a class="side-nav-item" href="https://developer.mozilla.org/en-US/docs/WebAssembly">MDN ↳</a>
        </nav>
      </div>
    </div>
  </div>
</section>
</body>
</html>
